<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HearRight - Execution Workflow Diagram</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1, h2 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .diagram-section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .mermaid {
            display: flex;
            justify-content: center;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
        
        .description {
            color: #666;
            line-height: 1.6;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .step-list {
            list-style: none;
            margin-top: 15px;
        }
        
        .step-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            color: #555;
        }
        
        .step-list li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
        }
        
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ HearRight - Complete Execution Workflow</h1>
        
        <!-- Setup Workflow -->
        <div class="diagram-section">
            <h2>1ï¸âƒ£ Installation & Setup Workflow</h2>
            <div class="mermaid">
                graph TD
                    A["ğŸ“ Project Directory<br/>HearRight/"] --> B["ğŸ”§ Install Dependencies<br/>npm install"]
                    B --> C{"âœ“ Node Modules<br/>Ready?"}
                    C -->|No| D["ğŸš¨ Fix Errors<br/>See Troubleshooting"]
                    D --> B
                    C -->|Yes| E["âœ“ Verify Installation<br/>node --version<br/>npm --version"]
                    E --> F["âœ… Ready for Development"]
            </div>
            <div class="description">
                <strong>Setup Steps:</strong>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Navigate to project directory: <code>cd HearRight</code></li>
                    <li>Install dependencies: <code>npm install</code></li>
                    <li>Verify Node v18+: <code>node --version</code></li>
                    <li>Start development: <code>npm run dev</code></li>
                </ol>
            </div>
        </div>
        
        <!-- Application Runtime -->
        <div class="diagram-section">
            <h2>2ï¸âƒ£ Application Runtime & Execution</h2>
            <div class="mermaid">
                graph TD
                    A["ğŸš€ npm run dev"] --> B["ğŸ“¦ Next.js Dev Server<br/>Port 3000"]
                    B --> C["ğŸ”„ Module Compilation"]
                    C --> D["âœ“ App Ready<br/>http://localhost:3000"]
                    D --> E["ğŸŒ Browser Opens"]
                    E --> F["ğŸ  Home Page Loads"]
                    F --> G["âœ… Application Running"]
                    
                    style A fill:#4CAF50,color:#fff
                    style G fill:#4CAF50,color:#fff
                    style D fill:#2196F3,color:#fff
            </div>
            <div class="description">
                Development server runs with hot reloading. Any file changes automatically refresh the browser.
                <br><strong>Stop with:</strong> <code>Ctrl + C</code>
            </div>
        </div>
        
        <!-- Data Flow During Test -->
        <div class="diagram-section">
            <h2>3ï¸âƒ£ User Interaction & Data Flow</h2>
            <div class="mermaid">
                graph LR
                    U["ğŸ‘¤ User Input"] --> P["ğŸ“ Patient Page"]
                    P --> |Register| O["ğŸ§ Onboarding"]
                    O --> |Calibrate| C["âš™ï¸ Calibration"]
                    C --> |Setup| T["ğŸ”Š Test Page"]
                    T --> |Respond| A["ğŸ§  Algorithm<br/>Hughson-Westlake"]
                    A --> |Process| S["ğŸ“Š State Store<br/>Zustand"]
                    S --> |Update| R["ğŸ“ˆ Results"]
                    R --> |Display| V["ğŸ“‰ Audiogram View"]
                    V --> |Export| PDF["ğŸ“„ PDF Report"]
                    
                    style U fill:#FF9800
                    style S fill:#9C27B0,color:#fff
                    style PDF fill:#4CAF50,color:#fff
            </div>
            <div class="description">
                Complete test workflow from patient registration to PDF report generation.
            </div>
        </div>
        
        <!-- Component Architecture -->
        <div class="diagram-section">
            <h2>4ï¸âƒ£ Component Architecture & Dependencies</h2>
            <div class="mermaid">
                graph TB
                    subgraph "Pages (App Router)"
                        P1["page.tsx<br/>Home"]
                        P2["patient/page.tsx"]
                        P3["test/page.tsx"]
                        P4["summary/page.tsx"]
                    end
                    
                    subgraph "Components"
                        C1["TestController"]
                        C2["AudiogramChart"]
                        C3["ResponsePad"]
                        C4["ThresholdTable"]
                    end
                    
                    subgraph "Libraries"
                        L1["audio-engine.ts<br/>Web Audio API"]
                        L2["hughson-westlake.ts<br/>Algorithm"]
                        L3["pdf-generator.ts"]
                        L4["storage.ts<br/>IndexedDB"]
                    end
                    
                    subgraph "State & Utils"
                        S1["zustand store<br/>State Management"]
                        U1["utils.ts<br/>generateUUID"]
                        U2["types.ts<br/>Interfaces"]
                    end
                    
                    P3 --> C1
                    C1 --> L1
                    C1 --> L2
                    P4 --> C2
                    P4 --> L3
                    C1 --> S1
                    L2 --> S1
                    L4 --> S1
                    C1 --> U1
                    C1 --> U2
                    
                    style P1 fill:#FF6B6B
                    style P2 fill:#FF6B6B
                    style P3 fill:#FF6B6B
                    style P4 fill:#FF6B6B
                    style S1 fill:#9C27B0,color:#fff
            </div>
            <div class="description">
                Component hierarchy showing how pages, components, and libraries interact through state management.
            </div>
        </div>
        
        <!-- State Management Flow -->
        <div class="diagram-section">
            <h2>5ï¸âƒ£ State Management Flow (Zustand)</h2>
            <div class="mermaid">
                graph TD
                    A["Action: Start Test"] --> B["Update Store<br/>setCurrentPatient"]
                    B --> C["Store State<br/>currentPatient"]
                    C --> D["Components Subscribe"]
                    D --> |Re-render| E["Test Controller"]
                    D --> |Re-render| F["Response Pad"]
                    D --> |Re-render| G["Test Progress"]
                    
                    A2["Action: Add Response"] --> B2["Update Store<br/>addThreshold"]
                    B2 --> C2["Store State<br/>thresholds"]
                    C2 --> D2["Components Subscribe"]
                    D2 --> H["Audiogram Updates"]
                    
                    style B fill:#4CAF50,color:#fff
                    style B2 fill:#4CAF50,color:#fff
                    style C fill:#2196F3,color:#fff
                    style C2 fill:#2196F3,color:#fff
            </div>
            <div class="description">
                Zustand manages global state. Components subscribe to store updates and re-render automatically.
            </div>
        </div>
        
        <!-- PDF Generation Flow -->
        <div class="diagram-section">
            <h2>6ï¸âƒ£ PDF Generation & Export Workflow</h2>
            <div class="mermaid">
                graph TD
                    A["User Clicks<br/>Generate PDF"] --> B["Collect Data<br/>Patient + Session"]
                    B --> C["Create PDF Document"]
                    C --> D["Add Header &<br/>Patient Info"]
                    D --> E["Add Test Summary"]
                    E --> F{"Need New<br/>Page?"}
                    F -->|Yes| G["Add New Page"]
                    G --> H["Add Threshold Table"]
                    F -->|No| H
                    H --> I{"Need New<br/>Page?"}
                    I -->|Yes| J["Add New Page"]
                    J --> K["Add Audiogram Chart"]
                    I -->|No| K
                    K --> L["Add PTA Results"]
                    L --> M["Add Clinical Notes"]
                    M --> N["Add Footer to All Pages"]
                    N --> O["Generate PDF Bytes"]
                    O --> P["Download/Print"]
                    
                    style O fill:#4CAF50,color:#fff
                    style P fill:#4CAF50,color:#fff
                    style F fill:#FFC107
                    style I fill:#FFC107
            </div>
            <div class="description">
                PDF generation with automatic page breaks for text wrapping. Multi-page support with page numbers and consistent footers.
            </div>
        </div>
        
        <!-- Complete User Journey -->
        <div class="diagram-section">
            <h2>7ï¸âƒ£ Complete User Journey Timeline</h2>
            <div class="mermaid">
                graph LR
                    A["ğŸ  HOME<br/>0 min"] --> B["ğŸ‘¤ REGISTER<br/>1-2 min"]
                    B --> C["ğŸ§ SETUP<br/>2-3 min"]
                    C --> D["âš™ï¸ CALIBRATE<br/>3-5 min"]
                    D --> E["ğŸ”Š TEST<br/>5-7 min"]
                    E --> F["ğŸ“ˆ RESULTS<br/>7-8 min"]
                    F --> G["ğŸ“„ PDF<br/>8-9 min"]
                    G --> H["âœ… COMPLETE<br/>9 min"]
                    
                    style A fill:#2196F3,color:#fff
                    style H fill:#4CAF50,color:#fff
            </div>
            <div class="description">
                <strong>Total Test Duration:</strong> ~9 minutes (including registration)
                <br><strong>Pure Tone Test Only:</strong> ~2 minutes
                <br><strong>PDF Generation:</strong> ~1 second
            </div>
        </div>
        
        <!-- Build & Deployment -->
        <div class="diagram-section">
            <h2>8ï¸âƒ£ Production Build & Deployment Workflow</h2>
            <div class="mermaid">
                graph TD
                    A["npm run build"] --> B["Optimize & Minify"]
                    B --> C["Generate Static Files"]
                    C --> D[".next Folder Created"]
                    D --> E["npm start"]
                    E --> F["Production Server<br/>Port 3000"]
                    F --> G["ğŸš€ Ready for Deploy"]
                    G --> H{"Deploy Target?"}
                    H -->|Vercel| I["vercel deploy"]
                    H -->|Docker| J["docker build & run"]
                    H -->|VPS| K["Copy to server"]
                    I --> L["âœ… Live"]
                    J --> L
                    K --> L
                    
                    style F fill:#2196F3,color:#fff
                    style L fill:#4CAF50,color:#fff
            </div>
            <div class="description">
                Production build optimizes the app for deployment. Serves minified code for better performance.
            </div>
        </div>
        
        <!-- Folder Tree with Execution -->
        <div class="diagram-section">
            <h2>9ï¸âƒ£ Project Folder Structure</h2>
            <pre style="background: #f5f5f5; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 12px;">
HearRight/
â”œâ”€â”€ app/                                    # Next.js 15 App Router
â”‚   â”œâ”€â”€ page.tsx                           # ğŸ  Home page
â”‚   â”œâ”€â”€ layout.tsx                         # Root layout + PWA config
â”‚   â”œâ”€â”€ globals.css                        # Global styles
â”‚   â”œâ”€â”€ patient/page.tsx                   # ğŸ‘¤ Patient registration
â”‚   â”œâ”€â”€ onboarding/page.tsx                # ğŸ§ Environment check
â”‚   â”œâ”€â”€ calibration/page.tsx               # âš™ï¸  Device calibration
â”‚   â”œâ”€â”€ test/page.tsx                      # ğŸ”Š Main hearing test
â”‚   â”œâ”€â”€ summary/page.tsx                   # ğŸ“ˆ Results & PDF
â”‚   â””â”€â”€ reports/
â”‚       â”œâ”€â”€ page.tsx                       # ğŸ“Š Reports list
â”‚       â””â”€â”€ [id]/page.tsx                  # ğŸ“„ Report details
â”‚
â”œâ”€â”€ components/                             # React components
â”‚   â”œâ”€â”€ ui/                                # shadcn UI library
â”‚   â”œâ”€â”€ test-controller.tsx                # ğŸ§  Test logic
â”‚   â”œâ”€â”€ audiogram-chart.tsx                # ğŸ“‰ Hearing chart
â”‚   â”œâ”€â”€ response-pad.tsx                   # âœ“ Response interface
â”‚   â”œâ”€â”€ pwa-install.tsx                    # ğŸ“± PWA installer
â”‚   â””â”€â”€ other components...
â”‚
â”œâ”€â”€ lib/                                   # Utilities & business logic
â”‚   â”œâ”€â”€ utils.ts                           # Helper functions (generateUUID)
â”‚   â”œâ”€â”€ types.ts                           # TypeScript interfaces
â”‚   â”œâ”€â”€ store.ts                           # âš™ï¸  Zustand state
â”‚   â”œâ”€â”€ audio-engine.ts                    # ğŸ”Š Web Audio API
â”‚   â”œâ”€â”€ hughson-westlake.ts                # ğŸ§® Audiometric algorithm
â”‚   â”œâ”€â”€ pdf-generator.ts                   # ğŸ“„ PDF creation
â”‚   â”œâ”€â”€ storage.ts                         # ğŸ’¾ IndexedDB
â”‚   â””â”€â”€ other utilities...
â”‚
â”œâ”€â”€ public/                                # Static assets
â”‚   â”œâ”€â”€ sw.js                              # ğŸ”„ Service worker
â”‚   â”œâ”€â”€ manifest.json                      # ğŸ“‹ PWA manifest
â”‚   â”œâ”€â”€ icon-192.png                       # ğŸ¨ App icon
â”‚   â””â”€â”€ other assets...
â”‚
â”œâ”€â”€ next.config.mjs                        # âš™ï¸  Next.js config
â”œâ”€â”€ tailwind.config.js                     # ğŸ¨ Tailwind config
â”œâ”€â”€ tsconfig.json                          # ğŸ“ TypeScript config
â”œâ”€â”€ package.json                           # ğŸ“¦ Dependencies
â””â”€â”€ README.md                              # ğŸ“– Documentation
            </pre>
        </div>
        
        <!-- Execution Summary -->
        <div class="diagram-section">
            <h2>ğŸ¯ Quick Reference Summary</h2>
            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                <tr style="background: #f5f5f5;">
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Action</th>
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Command</th>
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Time</th>
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Purpose</th>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">Install</td>
                    <td style="padding: 10px; border: 1px solid #ddd;"><code>npm install</code></td>
                    <td style="padding: 10px; border: 1px solid #ddd;">~5 min</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Setup dependencies</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">Dev Server</td>
                    <td style="padding: 10px; border: 1px solid #ddd;"><code>npm run dev</code></td>
                    <td style="padding: 10px; border: 1px solid #ddd;">~3 sec</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Development mode</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">Build</td>
                    <td style="padding: 10px; border: 1px solid #ddd;"><code>npm run build</code></td>
                    <td style="padding: 10px; border: 1px solid #ddd;">~2-5 min</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Production build</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">Start Prod</td>
                    <td style="padding: 10px; border: 1px solid #ddd;"><code>npm start</code></td>
                    <td style="padding: 10px; border: 1px solid #ddd;">~2 sec</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Run production</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">Lint</td>
                    <td style="padding: 10px; border: 1px solid #ddd;"><code>npm run lint</code></td>
                    <td style="padding: 10px; border: 1px solid #ddd;">~10 sec</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Code quality check</td>
                </tr>
            </table>
        </div>
    </div>
    
    <script>
        mermaid.contentLoaded();
    </script>
</body>
</html>
